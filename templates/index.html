
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resim Filtreleme Projesi</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 0;
            padding: 0;
            width: 100%;
            background-color: #f4f4f4;
        }
    
        .container {
            width: 80%;  /* Sağ ve soldaki boşlukları azaltıyoruz */
            margin: 0 auto;
            padding: 20px;
        }
    
        #imageContainer img {
            max-width: 100%;
            height: auto;
            margin-top: 20px;
            display: block;
            max-height: 400px;  /* Fotoğrafın yüksekliğini sınırlıyoruz */
        }
    
        #camera {
            margin-top: 20px;
            width: 100%;
            max-width: 300px;
            margin-bottom: 20px;
        }
    
        /* Düzenlemeleri tek satırda olacak şekilde yapıyoruz */
        .section-container {
            display: flex;
            justify-content: space-between;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
    
        .section {
            text-align: center;
            flex: 1;
            max-width: 400px;
        }
    
        .section select, .section button {
            width: 100%;
            max-width: 300px;
        }
    
        .image-and-filter {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;  /* Aradaki boşluğu azaltıyoruz */
            margin-top: 20px;
        }
    
        .image-container, .filter-container {
            width: 45%;  /* Her iki alanı eşit genişlikte yerleştir */
            max-width: 500px;
            max-height: 400px;  /* Yüklenen ve filtrelenen fotoğrafın yüksekliğini sınırlıyoruz */
            overflow: hidden;  /* Fotoğraf taşarsa gizlenir */
        }
    
        .image-container img, .filter-container img {
            width: 100%;
            height: auto;  /* Fotoğrafların boyutlarını düzgün tutuyoruz */
            max-height: 100%;
            object-fit: contain;  /* Fotoğrafın doğru şekilde görünmesini sağlıyoruz */
        }
    </style>
    
</head>
<body>

<div class="container">
    <h1>Resim Filtreleme Projesi</h1>

    <!-- File Upload Section -->
    <h2>Resim Yükle</h2>
    <input type="file" id="fileInput" accept="image/*">
    <button onclick="uploadImage()">Resim Yükle</button>

    <!-- Camera and Filter Section (Yan Yana Yerleştirildi) -->
    <div class="section-container">
        <!-- Camera Section -->
        <div class="section">
            <h2>Fotoğraf Çek</h2>
            <video id="camera" autoplay></video>
            <button onclick="captureImage()">Yakala</button>
        </div>

        <!-- Filter Section -->
        <div class="section">
            <h2>Filtre Uygula</h2>
            <select id="filterSelect">
                <option value="thresholding">Thresholding</option>
                <option value="sobel">Sobel</option>
                <option value="prewitt">Prewitt</option>
                <option value="roberts">Roberts</option>
                <option value="laplacian">Laplacian</option>
                <option value="canny">Canny</option>
                <option value="erosion">Erosion</option>
                <option value="harris">Harris</option>
                <option value="shi-tomasi">Shi-Tomasi</option>
                <option value="gaussian_blur">Gaussian Blur</option>
<option value="median_blur">Median Blur</option>
<option value="bilateral_filter">Bilateral Filter</option>
<option value="box_blur">Box Blur</option>
<option value="contour_detection">Contour Detection</option>
<option value="hough_transform">Hough Transform</option>
<option value="histogram_equalization">Histogram Equalization</option>

            </select>
            <button onclick="applyFilter()">Uygula</button>
        </div>
    </div>

    <!-- Fotoğraf ve Filtreyi Yan Yana Getiren Alan -->
    <div class="image-and-filter">
        <div class="image-container">
            <h2>Orijinal Fotoğraf</h2>
            <div id="imageContainer"></div>
        </div>

        <div class="filter-container">
            <h2>Filtrelenmiş Fotoğraf</h2>
            <div id="filteredImageContainer"></div>
        </div>
    </div>
</div>

<script>
    // Initialize camera and show the live feed
    function startCamera() {
        const video = document.getElementById('camera');
        if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
            navigator.mediaDevices.getUserMedia({ video: true })
                .then(function(stream) {
                    video.srcObject = stream;
                })
                .catch(function(error) {
                    console.log("Camera error: ", error);
                    alert("Camera access denied or unavailable.");
                });
        } else {
            alert("Your browser does not support camera access.");
        }
    }

    // Capture image from the camera
    function captureImage() {
        const video = document.getElementById('camera');
        const canvas = document.createElement('canvas');
        const context = canvas.getContext('2d');

        // Set canvas dimensions to match the video
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;

        // Draw the current frame from the video to the canvas
        context.drawImage(video, 0, 0, canvas.width, canvas.height);

        // Get base64 image data
        const base64Image = canvas.toDataURL();

        // Send base64 image to backend for upload
        uploadBase64Image(base64Image);
    }

    // Function to upload the base64 image to the backend
    function uploadBase64Image(base64Image) {
        fetch('/upload', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                image: base64Image
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.filepath) {
                displayImage(data.filepath);
            } else {
                alert('Error uploading image');
            }
        })
        .catch(error => {
            console.error('Error uploading image:', error);
        });
    }

    // Function to upload the selected image from file input
    function uploadImage() {
        const fileInput = document.getElementById('fileInput');
        const file = fileInput.files[0];

        if (!file) {
            alert('Please select an image file.');
            return;
        }

        const reader = new FileReader();
        reader.onloadend = function() {
            const base64Image = reader.result;

            // Send base64 image to backend
            uploadBase64Image(base64Image);
        };
        reader.readAsDataURL(file);
    }

    // Function to apply the selected filter to the uploaded image
    function applyFilter() {
        const filterSelect = document.getElementById('filterSelect');
        const selectedFilter = filterSelect.value;
        const filepath = document.getElementById('imageContainer').dataset.filepath;

        if (!filepath) {
            alert('No image to apply filter to.');
            return;
        }

        // Send filter type and image filepath to backend
        fetch('/filter', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                filepath: filepath,
                filter: selectedFilter
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.processed_filepath) {
                displayFilteredImage(data.processed_filepath);
            } else {
                alert('Error applying filter');
            }
        })
        .catch(error => {
            console.error('Error applying filter:', error);
        });
    }

    // Function to display uploaded image
    function displayImage(filepath) {
        const imageContainer = document.getElementById('imageContainer');
        imageContainer.innerHTML = '';  // Clear previous image
        const img = document.createElement('img');
        img.src = filepath;
        img.alt = 'Captured Image';
        imageContainer.appendChild(img);
        imageContainer.dataset.filepath = filepath;  // Save the filepath for filter
    }

    // Function to display filtered image
    function displayFilteredImage(filepath) {
        const filteredImageContainer = document.getElementById('filteredImageContainer');
        filteredImageContainer.innerHTML = '';  // Clear previous filtered image
        const img = document.createElement('img');
        img.src = filepath;
        img.alt = 'Filtered Image';
        filteredImageContainer.appendChild(img);
    }

    // Start the camera on page load
    startCamera();
</script>

</body>
</html>
